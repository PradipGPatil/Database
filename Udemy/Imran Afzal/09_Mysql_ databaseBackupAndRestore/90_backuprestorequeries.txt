CREATE TABLE SQLBackupRestoreTest (
	ID INT NOT NULL PRIMARY KEY,
	loginname VARCHAR(100) NOT NULL,
	logindate DATETIME NOT NULL DEFAULT getdate()
)
GO

select *  from SQLBackupRestoreTest;

insert into SQLBackupRestoreTest (ID,loginname) values (1, 'test1')
insert into SQLBackupRestoreTest (ID,loginname) values (2, 'test2')
insert into SQLBackupRestoreTest (ID,loginname) values (3, 'test3')
insert into SQLBackupRestoreTest (ID,loginname) values (4, 'test4')
insert into SQLBackupRestoreTest (ID,loginname) values (5, 'test5')

backup database adventureWorks2022 to disk= 'c:\backup\adventureWorks2022_07062025.bak' with STATS=5;

insert into SQLBackupRestoreTest (ID,loginname) values (6, 'test6')
insert into SQLBackupRestoreTest (ID,loginname) values (7, 'test7')
insert into SQLBackupRestoreTest (ID,loginname) values (8, 'test8')
insert into SQLBackupRestoreTest (ID,loginname) values (9, 'test9')
insert into SQLBackupRestoreTest (ID,loginname) values (10, 'test10');

backup database adventureWorks2022 to disk='c:\backup\aventureworks2022_07062025 diff.bak' with differential, stats=5

insert into SQLBackupRestoreTest (ID,loginname) values (11, 'test11')
insert into SQLBackupRestoreTest (ID,loginname) values (12, 'test12')
insert into SQLBackupRestoreTest (ID,loginname) values (13, 'test13');

-- trans log backup 1
backup log adventureWorks2022 to disk='c:\backup\aventureworks2022_07062025 log1.bak' ;


insert into SQLBackupRestoreTest (ID,loginname) values (14, 'test14')
insert into SQLBackupRestoreTest (ID,loginname) values (15, 'test15')
insert into SQLBackupRestoreTest (ID,loginname) values (16, 'test16')
insert into SQLBackupRestoreTest (ID,loginname) values (17, 'test17')

-- trans log bakcup 2
backup log adventureWorks2022 to disk='c:\backup\aventureworks2022_07062025 log2.bak' ;

-- 15.38
insert into SQLBackupRestoreTest (ID,loginname) values (114, 'test14')

--15.39
insert into SQLBackupRestoreTest (ID,loginname) values (115, 'test15')

-- trans log bakcup 3
backup log adventureWorks2022 to disk='c:\backup\aventureworks2022_07062025 log3.bak' ;

insert into SQLBackupRestoreTest (ID,loginname) values (116, 'test16')
insert into SQLBackupRestoreTest (ID,loginname) values (117, 'test17')

print getdate() -- Jun  7 2025  3:40PM

-- restore full backup
use master
go

-- check file name
RESTORE FILELISTONLY 
FROM DISK='c:\backup\adventureWorks2022_07062025.bak';

-- change file name 
restore database [adventureWorks]
from disk='c:\backup\adventureWorks2022_07062025.bak'
with 
move 'AdventureWorks2022' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks.mdf',
move 'AdventureWorks2022_log' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks_log.ldf',
norecovery,
stats=5;


-- restoring diff backup

RESTORE FILELISTONLY 
FROM DISK='c:\backup\aventureworks2022_07062025 diff.bak';

restore database [adventureWorks]
from disk='c:\backup\aventureworks2022_07062025 diff.bak'
with 
move 'AdventureWorks2022' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks.mdf',
move 'AdventureWorks2022_log' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks_log.ldf',
norecovery,
stats=5;


-- restoring logs 
RESTORE FILELISTONLY 
FROM DISK='c:\backup\aventureworks2022_07062025 log1.bak';

restore log [adventureWorks]
from disk='c:\backup\aventureworks2022_07062025 log1.bak'
with 
move 'AdventureWorks2022' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks.mdf',
move 'AdventureWorks2022_log' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks_log.ldf',
norecovery,
stats=5;


restore log [adventureWorks]
from disk='c:\backup\aventureworks2022_07062025 log2.bak'
with 
move 'AdventureWorks2022' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks.mdf',
move 'AdventureWorks2022_log' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks_log.ldf',
norecovery,
stats=5;

restore log [adventureWorks]
from disk='c:\backup\aventureworks2022_07062025 log3.bak'
with 
move 'AdventureWorks2022' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks.mdf',
move 'AdventureWorks2022_log' to 'C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\AdventureWorks_log.ldf',
norecovery,
stats=5;

restore database adventureWorks with recovery;

use adventureWorks
go
select * from SQLBackupRestoreTest;

-- 
--

print getdate()
-- Jul 26 2021  7:17AM

USE [master]
RESTORE DATABASE [AdventureWorks2016] FROM  DISK = N'C:\SQL_BACKUPS\AdventureWorks2016_full.BAK' WITH  FILE = 1,  NORECOVERY,  NOUNLOAD,  STATS = 5

GO

USE [master]
RESTORE DATABASE [AdventureWorks2016] FROM  DISK = N'C:\SQL_BACKUPS\AdventureWorks2016_diff_1.diff' WITH  FILE = 1,  NORECOVERY,  NOUNLOAD,  STATS = 5

GO

RESTORE LOG [AdventureWorks2016] FROM  DISK = N'C:\SQL_BACKUPS\AdventureWorks2016_tran_3.trn' WITH  FILE = 1,  NORECOVERY,  NOUNLOAD,  STATS = 10
GO


RESTORE DATABASE [AdventureWorks2016_RestoreTest] WITH RECOVERY
GO


USE [master]
RESTORE DATABASE [AdventureWorks2016_RestoreTest] FROM  DISK = N'C:\SQL_BACKUPS\AdventureWorks2016_full.BAK' WITH  FILE = 3,  
MOVE N'AdventureWorks2016_Data' TO N'C:\SQL_DATA_FILES\AdventureWorks2016_RestoreTest_Data.mdf',  MOVE N'AdventureWorks2016_Log' 
TO N'C:\SQL_LOG_FILES\AdventureWorks2016_RestoreTest_Log.ldf',  NORECOVERY,  NOUNLOAD,  STATS = 5
RESTORE DATABASE [AdventureWorks2016_RestoreTest] FROM  DISK = N'C:\SQL_BACKUPS\AdventureWorks2016_diff_1.diff' WITH  FILE = 3,  NORECOVERY,  NOUNLOAD,  STATS = 5

GO


RESTORE LOG [AdventureWorks2016_RestoreTest] FROM  DISK = N'C:\SQL_BACKUPS\AdventureWorks2016_tran_final.trn' WITH  FILE = 1,  NOUNLOAD,  STATS = 10, 
 STOPAT = N'2021-07-26T08:54:23'
GO
